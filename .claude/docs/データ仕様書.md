# ランダム散歩アプリ データ仕様書

## 1. データ概要

### 1.1 データ構造
本アプリケーションは2種類のマスタデータを使用します。

1. **locations（どこで）**: 散歩の場所を示すテキストデータ
2. **actions（なにをする）**: 散歩中の行動を示すテキストデータ

### 1.2 データ保存先
- データベース: Supabase (PostgreSQL)
- 管理方法: Supabase Dashboard経由で直接編集

## 2. locationsテーブル（どこで）

### 2.1 テーブル定義
| カラム名 | データ型 | 制約 | デフォルト値 | 説明 |
|---------|---------|------|------------|------|
| id | uuid | PRIMARY KEY | uuid_generate_v4() | 一意識別子 |
| text | text | NOT NULL | - | 場所のテキスト |
| is_active | boolean | NOT NULL | true | 有効/無効フラグ |
| created_at | timestamp | NOT NULL | now() | 作成日時 |
| updated_at | timestamp | NOT NULL | now() | 更新日時 |

### 2.2 初期データ（100件）

#### カテゴリ分類（参考）
データはカテゴリ分けせず、フラットに保存します。以下は内容の理解を助けるための分類です。

**公共スペース（25件）**
```
近くの公園で
駅前で
商店街で
図書館で
市役所で
郵便局で
コンビニで
スーパーで
デパートで
ショッピングモールで
本屋で
駅のホームで
バス停で
タクシー乗り場で
駐車場で
駐輪場で
交番で
消防署の前で
学校の前で
幼稚園の前で
公民館で
体育館の前で
プールの前で
美術館で
博物館で
```

**自然・屋外（25件）**
```
川沿いで
橋の上で
大きな木の下で
坂道で
階段で
線路沿いで
神社で
お寺で
墓地で
広場で
芝生の上で
花壇の前で
噴水の前で
池のほとりで
山道で
森の中で
海岸で
砂浜で
岩場で
展望台で
トンネルの前で
洞窟で
滝の前で
田んぼのそばで
畑のそばで
```

**店舗・施設（25件）**
```
カフェで
レストランで
ファストフード店で
ラーメン屋で
パン屋で
ケーキ屋で
アイスクリーム屋で
書店で
服屋で
靴屋で
雑貨屋で
花屋で
薬局で
病院で
歯医者で
美容院で
銀行で
郵便局で
コインランドリーで
ガソリンスタンドで
自動販売機の前で
ATMの前で
ゲームセンターで
カラオケ店で
映画館で
```

**道・移動（15件）**
```
見たことない道で
角を曲がったところで
路地裏で
横断歩道で
歩道橋の上で
地下道で
アーケード街で
自転車で5分先で
2駅先の駅で
3つ目の信号で
次の角で
一番遠い場所で
一番近い場所で
ベンチがある場所で
屋根がある場所で
```

**その他（10件）**
```
今いる場所で
振り返った場所で
目をつぶって10歩歩いた場所で
右に曲がった先で
左に曲がった先で
一番人が多い場所で
一番静かな場所で
一番明るい場所で
一番暗い場所で
一番気になった場所で
```

### 2.3 データ投入SQL
```sql
INSERT INTO locations (text) VALUES
('近くの公園で'),
('駅前で'),
('商店街で'),
('図書館で'),
('市役所で'),
('郵便局で'),
('コンビニで'),
('スーパーで'),
('デパートで'),
('ショッピングモールで'),
('本屋で'),
('駅のホームで'),
('バス停で'),
('タクシー乗り場で'),
('駐車場で'),
('駐輪場で'),
('交番で'),
('消防署の前で'),
('学校の前で'),
('幼稚園の前で'),
('公民館で'),
('体育館の前で'),
('プールの前で'),
('美術館で'),
('博物館で'),
('川沿いで'),
('橋の上で'),
('大きな木の下で'),
('坂道で'),
('階段で'),
('線路沿いで'),
('神社で'),
('お寺で'),
('墓地で'),
('広場で'),
('芝生の上で'),
('花壇の前で'),
('噴水の前で'),
('池のほとりで'),
('山道で'),
('森の中で'),
('海岸で'),
('砂浜で'),
('岩場で'),
('展望台で'),
('トンネルの前で'),
('洞窟で'),
('滝の前で'),
('田んぼのそばで'),
('畑のそばで'),
('カフェで'),
('レストランで'),
('ファストフード店で'),
('ラーメン屋で'),
('パン屋で'),
('ケーキ屋で'),
('アイスクリーム屋で'),
('書店で'),
('服屋で'),
('靴屋で'),
('雑貨屋で'),
('花屋で'),
('薬局で'),
('病院で'),
('歯医者で'),
('美容院で'),
('銀行で'),
('郵便局で'),
('コインランドリーで'),
('ガソリンスタンドで'),
('自動販売機の前で'),
('ATMの前で'),
('ゲームセンターで'),
('カラオケ店で'),
('映画館で'),
('見たことない道で'),
('角を曲がったところで'),
('路地裏で'),
('横断歩道で'),
('歩道橋の上で'),
('地下道で'),
('アーケード街で'),
('自転車で5分先で'),
('2駅先の駅で'),
('3つ目の信号で'),
('次の角で'),
('一番遠い場所で'),
('一番近い場所で'),
('ベンチがある場所で'),
('屋根がある場所で'),
('今いる場所で'),
('振り返った場所で'),
('目をつぶって10歩歩いた場所で'),
('右に曲がった先で'),
('左に曲がった先で'),
('一番人が多い場所で'),
('一番静かな場所で'),
('一番明るい場所で'),
('一番暗い場所で'),
('一番気になった場所で');
```

## 3. actionsテーブル（なにをする）

### 3.1 テーブル定義
| カラム名 | データ型 | 制約 | デフォルト値 | 説明 |
|---------|---------|------|------------|------|
| id | uuid | PRIMARY KEY | uuid_generate_v4() | 一意識別子 |
| text | text | NOT NULL | - | 行動のテキスト |
| is_active | boolean | NOT NULL | true | 有効/無効フラグ |
| created_at | timestamp | NOT NULL | now() | 作成日時 |
| updated_at | timestamp | NOT NULL | now() | 更新日時 |

### 3.2 初期データ（100件）

#### カテゴリ分類（参考）

**観察・鑑賞（20件）**
```
写真を撮る
動画を撮る
空を見上げる
雲の形を観察する
星を探す
鳥を探す
猫を探す
犬を探す
花を探す
虫を探す
看板を読む
ポスターを見る
建物を観察する
人を観察する
車を観察する
木を観察する
石を拾う
葉っぱを拾う
景色を眺める
夕日を見る
```

**購買・消費（20件）**
```
物を買う
飲み物を買う
お菓子を買う
一番高いものを買う
一番安いものを買う
ガチャガチャを回す
自動販売機で飲み物を買う
コーヒーを飲む
お茶を飲む
ジュースを飲む
アイスを食べる
パンを買う
おにぎりを買う
弁当を買う
雑誌を立ち読みする
試食する
試飲する
クーポンを探す
セール品を探す
新商品を探す
```

**コミュニケーション（15件）**
```
人と話す
店員さんと話す
店員さんにおすすめを聞く
道を聞く
挨拶する
笑顔で会釈する
知らない人に声をかける
電話する
メッセージを送る
SNSに投稿する
友達を誘う
家族に連絡する
写真を送る
感想を共有する
お礼を言う
```

**休息・リラックス（15件）**
```
5分座って休む
10分休憩する
深呼吸する
ストレッチする
目を閉じる
音楽を聴く
好きな音楽を1曲聴く
ラジオを聴く
Podcastを聴く
瞑想する
昼寝する
ベンチで休む
日向ぼっこする
風を感じる
水を飲む
```

**行動・探索（20件）**
```
知らない道を選ぶ
右に曲がる
左に曲がる
Uターンする
走る
スキップする
後ろ向きで歩く
目印を探す
地図を見る
迷う
引き返す
ショートカットを探す
遠回りする
階段を使う
エレベーターを使う
橋を渡る
トンネルをくぐる
10分歩く
100歩数える
立ち止まる
```

**その他・ユニーク（10件）**
```
スマホを見ずに5分過ごす
10枚写真を撮る
3回深呼吸する
占いをする
おみくじを引く
願い事をする
何もしない
サイコロを振る
コインを投げる
次の行動を決める
```

### 3.3 データ投入SQL
```sql
INSERT INTO actions (text) VALUES
('写真を撮る'),
('動画を撮る'),
('空を見上げる'),
('雲の形を観察する'),
('星を探す'),
('鳥を探す'),
('猫を探す'),
('犬を探す'),
('花を探す'),
('虫を探す'),
('看板を読む'),
('ポスターを見る'),
('建物を観察する'),
('人を観察する'),
('車を観察する'),
('木を観察する'),
('石を拾う'),
('葉っぱを拾う'),
('景色を眺める'),
('夕日を見る'),
('物を買う'),
('飲み物を買う'),
('お菓子を買う'),
('一番高いものを買う'),
('一番安いものを買う'),
('ガチャガチャを回す'),
('自動販売機で飲み物を買う'),
('コーヒーを飲む'),
('お茶を飲む'),
('ジュースを飲む'),
('アイスを食べる'),
('パンを買う'),
('おにぎりを買う'),
('弁当を買う'),
('雑誌を立ち読みする'),
('試食する'),
('試飲する'),
('クーポンを探す'),
('セール品を探す'),
('新商品を探す'),
('人と話す'),
('店員さんと話す'),
('店員さんにおすすめを聞く'),
('道を聞く'),
('挨拶する'),
('笑顔で会釈する'),
('知らない人に声をかける'),
('電話する'),
('メッセージを送る'),
('SNSに投稿する'),
('友達を誘う'),
('家族に連絡する'),
('写真を送る'),
('感想を共有する'),
('お礼を言う'),
('5分座って休む'),
('10分休憩する'),
('深呼吸する'),
('ストレッチする'),
('目を閉じる'),
('音楽を聴く'),
('好きな音楽を1曲聴く'),
('ラジオを聴く'),
('Podcastを聴く'),
('瞑想する'),
('昼寝する'),
('ベンチで休む'),
('日向ぼっこする'),
('風を感じる'),
('水を飲む'),
('知らない道を選ぶ'),
('右に曲がる'),
('左に曲がる'),
('Uターンする'),
('走る'),
('スキップする'),
('後ろ向きで歩く'),
('目印を探す'),
('地図を見る'),
('迷う'),
('引き返す'),
('ショートカットを探す'),
('遠回りする'),
('階段を使う'),
('エレベーターを使う'),
('橋を渡る'),
('トンネルをくぐる'),
('10分歩く'),
('100歩数える'),
('立ち止まる'),
('スマホを見ずに5分過ごす'),
('10枚写真を撮る'),
('3回深呼吸する'),
('占いをする'),
('おみくじを引く'),
('願い事をする'),
('何もしない'),
('サイコロを振る'),
('コインを投げる'),
('次の行動を決める');
```

## 4. データ管理

### 4.1 データの追加
Supabase Dashboardから直接INSERT文を実行、またはテーブルエディタで手動追加。

```sql
-- 新しい場所を追加
INSERT INTO locations (text) VALUES ('新しい場所');

-- 新しい行動を追加
INSERT INTO actions (text) VALUES ('新しい行動');
```

### 4.2 データの編集
```sql
-- テキストを修正
UPDATE locations SET text = '修正後のテキスト' WHERE id = 'uuid';

-- 更新日時は自動的にトリガーで更新される
```

### 4.3 データの無効化（削除せず非表示）
```sql
-- 特定のデータを無効化
UPDATE locations SET is_active = false WHERE id = 'uuid';
UPDATE actions SET is_active = false WHERE id = 'uuid';

-- 再度有効化
UPDATE locations SET is_active = true WHERE id = 'uuid';
```

### 4.4 データの完全削除
```sql
-- 物理削除（推奨しない）
DELETE FROM locations WHERE id = 'uuid';
DELETE FROM actions WHERE id = 'uuid';
```

### 4.5 一括操作
```sql
-- すべて有効化
UPDATE locations SET is_active = true;
UPDATE actions SET is_active = true;

-- すべて無効化
UPDATE locations SET is_active = false;
UPDATE actions SET is_active = false;

-- 特定の文字列を含むものを無効化
UPDATE locations SET is_active = false WHERE text LIKE '%駅%';
```

## 5. データ取得クエリ

### 5.1 アプリで使用するクエリ
```sql
-- ランダムに1件取得（locations）
SELECT id, text
FROM locations
WHERE is_active = true
ORDER BY RANDOM()
LIMIT 1;

-- ランダムに1件取得（actions）
SELECT id, text
FROM actions
WHERE is_active = true
ORDER BY RANDOM()
LIMIT 1;
```

### 5.2 管理用クエリ
```sql
-- 全件数の確認
SELECT COUNT(*) FROM locations WHERE is_active = true;
SELECT COUNT(*) FROM actions WHERE is_active = true;

-- 全データの一覧
SELECT * FROM locations ORDER BY created_at DESC;
SELECT * FROM actions ORDER BY created_at DESC;

-- 無効化されたデータの一覧
SELECT * FROM locations WHERE is_active = false;
SELECT * FROM actions WHERE is_active = false;
```

## 6. データ拡張案

### 6.1 将来的な拡張（今回は実装しない）

**カテゴリ機能**
```sql
-- カラム追加案
ALTER TABLE locations ADD COLUMN category text;
ALTER TABLE actions ADD COLUMN category text;

-- カテゴリ例
-- locations: '公共施設', '自然', '店舗', '道'
-- actions: '観察', '購買', '休息', '探索'
```

**難易度機能**
```sql
-- カラム追加案
ALTER TABLE locations ADD COLUMN difficulty integer DEFAULT 1;
ALTER TABLE actions ADD COLUMN difficulty integer DEFAULT 1;

-- 難易度: 1=簡単, 2=普通, 3=難しい
```

**タグ機能**
```sql
-- タグテーブル作成案
CREATE TABLE tags (
  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),
  name text NOT NULL
);

CREATE TABLE location_tags (
  location_id uuid REFERENCES locations(id),
  tag_id uuid REFERENCES tags(id),
  PRIMARY KEY (location_id, tag_id)
);

-- タグ例: '屋内', '屋外', '一人向け', '複数人向け'
```

## 7. データバックアップ

### 7.1 エクスポート
Supabase DashboardからテーブルデータをCSVまたはJSON形式でエクスポート可能。

### 7.2 インポート
CSVファイルから一括インポート可能。

```sql
-- CSVインポート例（Supabase Dashboard使用）
-- 1. Table Editorで対象テーブルを開く
-- 2. Importボタンをクリック
-- 3. CSVファイルを選択してアップロード
```

## 8. データ品質管理

### 8.1 データの基準
- 末尾に「で」「する」を統一
- 1件あたり20文字以内を推奨
- 重複データの禁止
- 誤字脱字のチェック

### 8.2 重複チェッククエリ
```sql
-- 重複データの検出（locations）
SELECT text, COUNT(*)
FROM locations
GROUP BY text
HAVING COUNT(*) > 1;

-- 重複データの検出（actions）
SELECT text, COUNT(*)
FROM actions
GROUP BY text
HAVING COUNT(*) > 1;
```

### 8.3 データバリデーション
```sql
-- 空白文字のみのデータをチェック
SELECT * FROM locations WHERE TRIM(text) = '';
SELECT * FROM actions WHERE TRIM(text) = '';

-- 極端に長いテキストをチェック
SELECT * FROM locations WHERE LENGTH(text) > 50;
SELECT * FROM actions WHERE LENGTH(text) > 50;
```

## 9. データ統計

### 9.1 分析用クエリ
```sql
-- 平均文字数
SELECT AVG(LENGTH(text)) as avg_length FROM locations;
SELECT AVG(LENGTH(text)) as avg_length FROM actions;

-- 最長・最短データ
SELECT text, LENGTH(text) FROM locations ORDER BY LENGTH(text) DESC LIMIT 1;
SELECT text, LENGTH(text) FROM locations ORDER BY LENGTH(text) ASC LIMIT 1;

-- 有効データと無効データの割合
SELECT
  is_active,
  COUNT(*) as count,
  ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) as percentage
FROM locations
GROUP BY is_active;
```

## 10. 補足事項

### 10.1 データの考え方
- 「どこで」×「なにをする」の組み合わせは完全ランダム
- すべての組み合わせが可能（制約なし）
- 理論上の組み合わせ数: 100 × 100 = 10,000通り

### 10.2 データメンテナンス頻度
- 定期的な見直し: 月1回推奨
- ユーザーフィードバックに基づく追加・修正
- 季節に応じたデータの追加（例: 夏限定の行動）

### 10.3 データの所有権
- すべてのデータは管理者が管理
- ユーザーからのデータ投稿機能は今回対象外
